---
title: "주성분 분석을 활용한 보험 위험요인 차원 축소"
date: "2025-02-18"
category: "analysis"
tags: ["주성분분석", "차원축소", "보험분석"]
excerpt: "주성분 분석의 이론적 배경과 보험 위험요인 차원 축소에서의 활용법을 살펴보고, 실무 적용 사례를 제공합니다."
---

주성분 분석(Principal Component Analysis, PCA)은 보험업계에서 고차원 데이터를 저차원으로 축소하는 핵심 기법입니다. 이번 포스트에서는 주성분 분석의 이론적 배경과 보험 위험요인 차원 축소에서의 실무적 활용법을 자세히 살펴보겠습니다.

## 주성분 분석의 정의와 목적

주성분 분석은 고차원 데이터를 저차원으로 축소하면서 데이터의 분산을 최대한 보존하는 기법입니다:

### 1. 주성분 분석의 목적

- **차원 축소**: 고차원 데이터를 저차원으로 축소
- **노이즈 제거**: 데이터에서 노이즈 제거
- **시각화**: 고차원 데이터의 시각화
- **특성 추출**: 중요한 특성 추출

### 2. 주성분 분석의 원리

**주성분 = 고유벡터 × 원본 데이터**

```
PC₁ = e₁₁X₁ + e₁₂X₂ + ... + e₁ₚXₚ
PC₂ = e₂₁X₁ + e₂₂X₂ + ... + e₂ₚXₚ
```

여기서:
- **PCᵢ**: i번째 주성분
- **eᵢⱼ**: 고유벡터의 j번째 성분
- **Xⱼ**: j번째 원본 변수

## 보험업계에서의 주성분 분석 활용

### 1. 주요 활용 영역

- **위험요인 분석**: 보험 위험요인의 차원 축소
- **손해액 예측**: 차원 축소된 데이터로 손해액 예측
- **고객 세분화**: 고차원 고객 데이터의 차원 축소
- **시각화**: 고차원 데이터의 시각화

### 2. 파이썬을 활용한 주성분 분석

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.decomposition import PCA
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score
import warnings
warnings.filterwarnings('ignore')

# 보험 위험요인 데이터 생성 (예시)
np.random.seed(42)
n_samples = 1000

# 위험요인들
age = np.random.normal(35, 10, n_samples)
driving_experience = np.random.normal(10, 5, n_samples)
car_value = np.random.normal(20000, 5000, n_samples)
claims_history = np.random.poisson(2, n_samples)
weather_risk = np.random.uniform(0, 1, n_samples)
road_condition = np.random.uniform(0, 1, n_samples)
time_of_day = np.random.uniform(0, 24, n_samples)
traffic_density = np.random.uniform(0, 1, n_samples)

# 손해액 (위험요인들의 선형 조합 + 노이즈)
damage_amount = (1000 + 50*age - 20*driving_experience + 0.1*car_value + 
                 200*claims_history + 500*weather_risk + 300*road_condition + 
                 10*time_of_day + 400*traffic_density + np.random.normal(0, 200, n_samples))

# 데이터프레임 생성
data = pd.DataFrame({
    'age': age,
    'driving_experience': driving_experience,
    'car_value': car_value,
    'claims_history': claims_history,
    'weather_risk': weather_risk,
    'road_condition': road_condition,
    'time_of_day': time_of_day,
    'traffic_density': traffic_density,
    'damage_amount': damage_amount
})

print("보험 위험요인 데이터 기본 통계:")
print(data.describe())
```

### 3. 주성분 분석 수행

```python
def principal_component_analysis(data, n_components=None):
    """주성분 분석"""
    
    # 특성과 타겟 분리
    X = data.drop('damage_amount', axis=1)
    y = data['damage_amount']
    
    # 데이터 정규화
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)
    
    # 주성분 분석
    pca = PCA(n_components=n_components)
    X_pca = pca.fit_transform(X_scaled)
    
    # 설명 분산 비율
    explained_variance_ratio = pca.explained_variance_ratio_
    cumulative_variance_ratio = np.cumsum(explained_variance_ratio)
    
    print("주성분 분석 결과:")
    print(f"  주성분 수: {pca.n_components_}")
    print(f"  설명 분산 비율: {explained_variance_ratio}")
    print(f"  누적 설명 분산 비율: {cumulative_variance_ratio}")
    
    return pca, X_pca, explained_variance_ratio, cumulative_variance_ratio

# 주성분 분석 실행
pca, X_pca, explained_variance_ratio, cumulative_variance_ratio = principal_component_analysis(data)
```

### 4. 주성분 분석 시각화

```python
def visualize_pca_results(explained_variance_ratio, cumulative_variance_ratio, X_pca):
    """주성분 분석 결과 시각화"""
    
    fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(15, 12))
    
    # 설명 분산 비율
    ax1.bar(range(1, len(explained_variance_ratio) + 1), explained_variance_ratio)
    ax1.set_title('설명 분산 비율')
    ax1.set_xlabel('주성분')
    ax1.set_ylabel('설명 분산 비율')
    ax1.grid(True, alpha=0.3)
    
    # 누적 설명 분산 비율
    ax2.plot(range(1, len(cumulative_variance_ratio) + 1), cumulative_variance_ratio, 'bo-')
    ax2.axhline(y=0.95, color='r', linestyle='--', label='95%')
    ax2.set_title('누적 설명 분산 비율')
    ax2.set_xlabel('주성분')
    ax2.set_ylabel('누적 설명 분산 비율')
    ax2.legend()
    ax2.grid(True, alpha=0.3)
    
    # 첫 번째와 두 번째 주성분 산점도
    ax3.scatter(X_pca[:, 0], X_pca[:, 1], alpha=0.6)
    ax3.set_title('첫 번째 vs 두 번째 주성분')
    ax3.set_xlabel('PC1')
    ax3.set_ylabel('PC2')
    ax3.grid(True, alpha=0.3)
    
    # 주성분 로딩
    ax4.bar(range(len(pca.components_[0])), pca.components_[0])
    ax4.set_title('첫 번째 주성분 로딩')
    ax4.set_xlabel('원본 변수')
    ax4.set_ylabel('로딩')
    ax4.grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.show()

# 주성분 분석 시각화 실행
visualize_pca_results(explained_variance_ratio, cumulative_variance_ratio, X_pca)
```

## 엑셀을 활용한 주성분 분석

### 1. 기본 설정

```excel
A1: 고객ID
B1: 나이
C1: 운전경력
D1: 차량가격
E1: 사고이력
F1: 날씨위험
G1: 도로상태
H1: 시간
I1: 교통밀도
J1: 손해액

A2: =ROW()-1
B2: =RAND()*50+20
C2: =RAND()*20+1
D2: =RAND()*30000+10000
E2: =POISSON.DIST(RAND(),2,TRUE)
F2: =RAND()
G2: =RAND()
H2: =RAND()*24
I2: =RAND()
J2: =1000+50*B2-20*C2+0.1*D2+200*E2+500*F2+300*G2+10*H2+400*I2+RAND()*400-200
```

### 2. 공분산 행렬 계산

```excel
# 공분산 행렬
A15: 변수
B15: 나이
C15: 운전경력
D15: 차량가격
E15: 사고이력
F15: 날씨위험
G15: 도로상태
H15: 시간
I15: 교통밀도

A16: 나이
B16: =COVAR(B2:B1001,B2:B1001)
C16: =COVAR(B2:B1001,C2:C1001)
D16: =COVAR(B2:B1001,D2:D1001)
E16: =COVAR(B2:B1001,E2:E1001)
F16: =COVAR(B2:B1001,F2:F1001)
G16: =COVAR(B2:B1001,G2:G1001)
H16: =COVAR(B2:B1001,H2:H1001)
I16: =COVAR(B2:B1001,I2:I1001)
```

### 3. 고유값과 고유벡터

```excel
# 고유값 계산
A25: 고유값
B25: =EIGENVAL(B16:I23)

# 고유벡터 계산
A30: 고유벡터
B30: =EIGENVEC(B16:I23)
```

## 고급 분석 기법

### 1. 주성분 수 선택

```python
def select_optimal_components(data, variance_threshold=0.95):
    """최적 주성분 수 선택"""
    
    # 특성과 타겟 분리
    X = data.drop('damage_amount', axis=1)
    
    # 데이터 정규화
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)
    
    # 주성분 분석
    pca = PCA()
    X_pca = pca.fit_transform(X_scaled)
    
    # 누적 설명 분산 비율
    cumulative_variance_ratio = np.cumsum(pca.explained_variance_ratio_)
    
    # 최적 주성분 수
    optimal_components = np.argmax(cumulative_variance_ratio >= variance_threshold) + 1
    
    print(f"최적 주성분 수: {optimal_components}")
    print(f"설명 분산 비율: {cumulative_variance_ratio[optimal_components - 1]:.3f}")
    
    return optimal_components, cumulative_variance_ratio

# 최적 주성분 수 선택 실행
optimal_components, cumulative_variance_ratio = select_optimal_components(data)
```

### 2. 주성분 회귀분석

```python
def principal_component_regression(data, n_components=3):
    """주성분 회귀분석"""
    
    # 특성과 타겟 분리
    X = data.drop('damage_amount', axis=1)
    y = data['damage_amount']
    
    # 데이터 정규화
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)
    
    # 주성분 분석
    pca = PCA(n_components=n_components)
    X_pca = pca.fit_transform(X_scaled)
    
    # 훈련/테스트 데이터 분할
    X_train, X_test, y_train, y_test = train_test_split(X_pca, y, test_size=0.2, random_state=42)
    
    # 선형 회귀 모델
    model = LinearRegression()
    model.fit(X_train, y_train)
    
    # 예측
    y_pred = model.predict(X_test)
    
    # 모델 평가
    mse = mean_squared_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)
    
    print(f"주성분 회귀분석 결과:")
    print(f"  주성분 수: {n_components}")
    print(f"  MSE: {mse:.2f}")
    print(f"  R²: {r2:.3f}")
    
    return model, mse, r2

# 주성분 회귀분석 실행
pcr_model, pcr_mse, pcr_r2 = principal_component_regression(data, n_components=3)
```

## 실무 적용 사례

### 사례 1: 자동차보험 위험요인 분석

```python
def auto_insurance_risk_factor_analysis():
    """자동차보험 위험요인 분석"""
    
    # 실제 자동차보험 데이터 (예시)
    np.random.seed(42)
    n_samples = 2000
    
    # 위험요인들
    age = np.random.normal(35, 10, n_samples)
    driving_experience = np.random.normal(10, 5, n_samples)
    car_value = np.random.normal(20000, 5000, n_samples)
    claims_history = np.random.poisson(2, n_samples)
    weather_risk = np.random.uniform(0, 1, n_samples)
    road_condition = np.random.uniform(0, 1, n_samples)
    time_of_day = np.random.uniform(0, 24, n_samples)
    traffic_density = np.random.uniform(0, 1, n_samples)
    
    # 손해액 계산
    damage_amount = (1000 + 50*age - 20*driving_experience + 0.1*car_value + 
                     200*claims_history + 500*weather_risk + 300*road_condition + 
                     10*time_of_day + 400*traffic_density + np.random.normal(0, 200, n_samples))
    
    # 데이터프레임 생성
    data = pd.DataFrame({
        'age': age,
        'driving_experience': driving_experience,
        'car_value': car_value,
        'claims_history': claims_history,
        'weather_risk': weather_risk,
        'road_condition': road_condition,
        'time_of_day': time_of_day,
        'traffic_density': traffic_density,
        'damage_amount': damage_amount
    })
    
    # 주성분 분석
    X = data.drop('damage_amount', axis=1)
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)
    
    pca = PCA(n_components=3)
    X_pca = pca.fit_transform(X_scaled)
    
    # 주성분 로딩 분석
    feature_names = X.columns
    pca_components = pca.components_
    
    print("자동차보험 위험요인 주성분 분석 결과:")
    for i, component in enumerate(pca_components):
        print(f"\n주성분 {i+1}:")
        for j, feature in enumerate(feature_names):
            print(f"  {feature}: {component[j]:.3f}")
    
    return data, pca, X_pca

# 자동차보험 위험요인 분석 실행
risk_analysis = auto_insurance_risk_factor_analysis()
```

### 사례 2: 보험료 산출 시스템

```python
def premium_calculation_with_pca(model, customer_data):
    """주성분 분석을 통한 보험료 산출 시스템"""
    
    # 고객 데이터 정규화
    scaler = StandardScaler()
    customer_scaled = scaler.fit_transform([customer_data])
    
    # 주성분 변환
    pca = PCA(n_components=3)
    customer_pca = pca.fit_transform(customer_scaled)
    
    # 예측
    predicted_damage = model.predict(customer_pca)[0]
    
    # 보험료 계산
    base_premium = 1000
    risk_loading = predicted_damage * 0.1
    total_premium = base_premium + risk_loading
    
    return {
        'predicted_damage': predicted_damage,
        'base_premium': base_premium,
        'risk_loading': risk_loading,
        'total_premium': total_premium
    }

# 보험료 산출 시스템 실행
customer_data = [30, 5, 25000, 1, 0.7, 0.8, 14, 0.6]  # [나이, 운전경력, 차량가격, 사고이력, 날씨위험, 도로상태, 시간, 교통밀도]
premium_result = premium_calculation_with_pca(pcr_model, customer_data)
for key, value in premium_result.items():
    print(f"{key}: {value}")
```

## 주성분 분석의 한계와 주의사항

### 1. 주성분 분석의 한계

- **선형 관계**: 비선형 관계 모델링 어려움
- **해석**: 주성분의 의미 해석의 어려움
- **정보 손실**: 차원 축소로 인한 정보 손실

### 2. 주의사항

- **데이터 전처리**: 데이터 정규화가 중요
- **주성분 수**: 적절한 주성분 수 선택
- **해석**: 주성분의 의미 해석 필요

## 결론

주성분 분석은 보험업계에서 고차원 데이터의 차원 축소와 특성 추출의 핵심 기법입니다. 특히 위험요인 분석, 손해액 예측, 고객 세분화에 직접적으로 활용할 수 있습니다.

다음 포스트에서는 요인 분석을 활용한 보험 모델링에 대해 살펴보겠습니다.

## 참고자료

- [Real Statistics - Miscellaneous](https://real-statistics.com/miscellaneous/)
- Klugman, S. A., Panjer, H. H., & Willmot, G. E. (2012). Loss Models: From Data to Decisions
- Kaas, R., Goovaerts, M., Dhaene, J., & Denuit, M. (2008). Modern Actuarial Risk Theory
