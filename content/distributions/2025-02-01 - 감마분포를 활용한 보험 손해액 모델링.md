---
title: "감마분포를 활용한 보험 손해액 모델링"
date: "2025-02-01"
category: "distributions"
tags: ["감마분포", "손해액", "모델링"]
excerpt: "감마분포의 이론적 배경과 보험 손해액 모델링에서의 활용법을 살펴보고, 최대우도추정법을 통한 매개변수 추정과 실무 적용 사례를 제공합니다."
---

감마분포(Gamma Distribution)는 보험업계에서 손해액 모델링에 매우 유용한 분포입니다. 특히 양의 값만을 가지는 손해 데이터에 적합하며, 다양한 형태를 가질 수 있어 유연한 모델링이 가능합니다.

## 감마분포의 정의와 특성

감마분포는 두 개의 매개변수 α(형상모수)와 β(척도모수)를 가지는 연속확률분포입니다:

```
f(x) = (β^α / Γ(α)) * x^(α-1) * e^(-βx)
```

여기서:
- **α (alpha)**: 형상모수 (shape parameter)
- **β (beta)**: 척도모수 (scale parameter)
- **Γ(α)**: 감마함수

### 감마분포의 주요 특성

1. **지지집합**: x > 0 (양의 값만)
2. **평균**: E[X] = α/β
3. **분산**: Var[X] = α/β²
4. **유연성**: α 값에 따라 다양한 형태 가능
   - α < 1: 지수적으로 감소
   - α = 1: 지수분포
   - α > 1: 종모양 분포

## 보험업계에서의 감마분포 활용

### 1. 손해액 모델링의 장점

감마분포가 보험 손해액 모델링에 적합한 이유:

- **양의 값**: 손해액은 항상 양수
- **유연성**: 다양한 손해 패턴 모델링 가능
- **수학적 편의성**: 합성분포(Compound Distribution) 계산 용이

### 2. 파이썬을 활용한 감마분포 모델링

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.optimize import minimize
import pandas as pd

# 감마분포 매개변수 추정 함수
def estimate_gamma_params(data):
    """최대우도추정법을 통한 감마분포 매개변수 추정"""
    
    def negative_log_likelihood(params):
        alpha, beta = params
        if alpha <= 0 or beta <= 0:
            return np.inf
        return -np.sum(stats.gamma.logpdf(data, alpha, scale=1/beta))
    
    # 초기값 설정
    mean_data = np.mean(data)
    var_data = np.var(data, ddof=1)
    alpha_init = mean_data**2 / var_data
    beta_init = mean_data / var_data
    
    # 최적화
    result = minimize(negative_log_likelihood, 
                     [alpha_init, beta_init], 
                     method='L-BFGS-B',
                     bounds=[(0.01, None), (0.01, None)])
    
    return result.x[0], result.x[1]

# 실제 손해 데이터 (예시)
np.random.seed(42)
true_alpha, true_beta = 2.5, 0.01
loss_data = np.random.gamma(true_alpha, 1/true_beta, 1000)

# 매개변수 추정
estimated_alpha, estimated_beta = estimate_gamma_params(loss_data)

print(f"실제 매개변수: α={true_alpha}, β={true_beta}")
print(f"추정 매개변수: α={estimated_alpha:.3f}, β={estimated_beta:.3f}")
```

### 3. 감마분포 적합도 검정

```python
def gamma_goodness_of_fit(data, alpha, beta):
    """감마분포 적합도 검정"""
    
    # Kolmogorov-Smirnov 테스트
    ks_stat, ks_pvalue = stats.kstest(data, 
                                     lambda x: stats.gamma.cdf(x, alpha, scale=1/beta))
    
    # Anderson-Darling 테스트
    ad_stat, ad_critical, ad_significance = stats.anderson(data, dist='gamma')
    
    print(f"Kolmogorov-Smirnov 통계량: {ks_stat:.4f}")
    print(f"KS p-value: {ks_pvalue:.4f}")
    print(f"Anderson-Darling 통계량: {ad_stat:.4f}")
    
    return ks_stat, ks_pvalue, ad_stat

# 적합도 검정 실행
ks_stat, ks_pvalue, ad_stat = gamma_goodness_of_fit(loss_data, estimated_alpha, estimated_beta)
```

### 4. 시각화 및 분석

```python
def visualize_gamma_fit(data, alpha, beta):
    """감마분포 적합 결과 시각화"""
    
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))
    
    # 히스토그램과 적합된 분포
    ax1.hist(data, bins=50, density=True, alpha=0.7, color='skyblue', label='실제 데이터')
    x_range = np.linspace(0, np.max(data), 1000)
    fitted_pdf = stats.gamma.pdf(x_range, alpha, scale=1/beta)
    ax1.plot(x_range, fitted_pdf, 'r-', linewidth=2, label='감마분포 적합')
    ax1.set_title('감마분포 적합 결과')
    ax1.set_xlabel('손해액')
    ax1.set_ylabel('확률밀도')
    ax1.legend()
    
    # Q-Q 플롯
    stats.probplot(data, dist=stats.gamma, sparams=(alpha, 0, 1/beta), plot=ax2)
    ax2.set_title('Q-Q 플롯 (감마분포)')
    
    plt.tight_layout()
    plt.show()

# 시각화 실행
visualize_gamma_fit(loss_data, estimated_alpha, estimated_beta)
```

## 엑셀을 활용한 감마분포 분석

### 1. 기본 설정

```excel
A1: 형상모수 (α)
B1: 2.5
A2: 척도모수 (β)
B2: 0.01
A3: 샘플 크기
B3: 1000
```

### 2. 감마분포 함수 활용

```excel
# 감마분포 확률밀도함수
A5: =GAMMA.DIST(x, α, 1/β, FALSE)

# 감마분포 누적분포함수
A6: =GAMMA.DIST(x, α, 1/β, TRUE)

# 감마분포 역함수
A7: =GAMMA.INV(확률, α, 1/β)
```

### 3. 보험료 산출

```excel
A10: 기대손해액
B10: =B1/B2
A11: 분산
B11: =B1/(B2^2)
A12: 표준편차
B12: =SQRT(B11)
A13: 안전부하율
B13: 0.2
A14: 보험료
B14: =B10+B13*B12
```

## 고급 분석 기법

### 1. 베이지안 추정

```python
import pymc3 as pm
import theano.tensor as tt

def bayesian_gamma_estimation(data):
    """베이지안 방법을 통한 감마분포 매개변수 추정"""
    
    with pm.Model() as model:
        # 사전분포 설정
        alpha = pm.Gamma('alpha', alpha=1, beta=1)
        beta = pm.Gamma('beta', alpha=1, beta=1)
        
        # 우도함수
        likelihood = pm.Gamma('likelihood', alpha=alpha, beta=beta, observed=data)
        
        # MCMC 샘플링
        trace = pm.sample(2000, tune=1000, cores=2)
    
    return trace

# 베이지안 추정 실행
trace = bayesian_gamma_estimation(loss_data)
pm.traceplot(trace)
plt.show()
```

### 2. 혼합감마분포 모델

```python
def mixture_gamma_model(data, n_components=2):
    """혼합감마분포 모델"""
    
    from sklearn.mixture import GaussianMixture
    
    # 로그 변환 (정규분포에 가깝게)
    log_data = np.log(data)
    
    # EM 알고리즘을 통한 혼합분포 추정
    gmm = GaussianMixture(n_components=n_components, random_state=42)
    gmm.fit(log_data.reshape(-1, 1))
    
    return gmm

# 혼합모델 적용
mixture_model = mixture_gamma_model(loss_data)
print(f"혼합분포 가중치: {mixture_model.weights_}")
print(f"혼합분포 평균: {mixture_model.means_.flatten()}")
print(f"혼합분포 분산: {mixture_model.covariances_.flatten()}")
```

## 실무 적용 사례

### 사례 1: 자동차보험 손해액 모델링

```python
def auto_insurance_gamma_modeling():
    """자동차보험 손해액 감마분포 모델링"""
    
    # 실제 자동차보험 손해 데이터 (예시)
    auto_losses = np.random.gamma(2.0, 1/0.005, 2000)
    
    # 매개변수 추정
    alpha_est, beta_est = estimate_gamma_params(auto_losses)
    
    # 리스크 측정
    mean_loss = alpha_est / beta_est
    var_loss = alpha_est / (beta_est ** 2)
    
    # VaR 계산
    var_95 = stats.gamma.ppf(0.05, alpha_est, scale=1/beta_est)
    var_99 = stats.gamma.ppf(0.01, alpha_est, scale=1/beta_est)
    
    print(f"자동차보험 손해액 분석:")
    print(f"평균 손해액: {mean_loss:.2f}")
    print(f"분산: {var_loss:.2f}")
    print(f"95% VaR: {var_95:.2f}")
    print(f"99% VaR: {var_99:.2f}")
    
    return alpha_est, beta_est, mean_loss, var_95, var_99
```

### 사례 2: 보험료 산출 시스템

```python
def gamma_premium_calculation(alpha, beta, safety_loading=0.15, confidence_level=0.95):
    """감마분포를 활용한 보험료 산출"""
    
    # 기대손해액
    expected_loss = alpha / beta
    
    # 표준편차
    std_loss = np.sqrt(alpha / (beta ** 2))
    
    # 안전부하
    safety_margin = safety_loading * std_loss
    
    # 리스크 부하 (VaR 기반)
    var = stats.gamma.ppf(1 - confidence_level, alpha, scale=1/beta)
    risk_loading = max(0, var - expected_loss) * 0.1
    
    # 총 보험료
    total_premium = expected_loss + safety_margin + risk_loading
    
    return {
        'expected_loss': expected_loss,
        'safety_margin': safety_margin,
        'risk_loading': risk_loading,
        'total_premium': total_premium,
        'var': var
    }

# 보험료 산출 실행
premium_result = gamma_premium_calculation(estimated_alpha, estimated_beta)
for key, value in premium_result.items():
    print(f"{key}: {value:.2f}")
```

## 감마분포의 한계와 대안

### 1. 감마분포의 한계

- **단일 모드**: 복잡한 손해 패턴 모델링 어려움
- **꼬리 위험**: 극단적 손해에 대한 과소평가 가능성
- **매개변수 해석**: α, β 매개변수의 직관적 해석 어려움

### 2. 대안 분포들

- **로그정규분포**: 더 긴 꼬리를 가진 분포
- **와이블분포**: 다양한 형태의 위험도 함수
- **혼합분포**: 복잡한 손해 패턴 모델링

## 결론

감마분포는 보험 손해액 모델링에서 매우 유용한 도구입니다. 특히 양의 값만을 가지는 손해 데이터에 적합하며, 유연한 형태로 다양한 손해 패턴을 모델링할 수 있습니다.

다음 포스트에서는 지수분포와 와이블분포를 활용한 보험 모델링에 대해 살펴보겠습니다.

## 참고자료

- [Real Statistics - Gamma Distribution](https://real-statistics.com/distributions/)
- Klugman, S. A., Panjer, H. H., & Willmot, G. E. (2012). Loss Models: From Data to Decisions
- Kaas, R., Goovaerts, M., Dhaene, J., & Denuit, M. (2008). Modern Actuarial Risk Theory
