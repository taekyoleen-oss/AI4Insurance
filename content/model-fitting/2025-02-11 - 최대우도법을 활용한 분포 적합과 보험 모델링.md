---
title: "최대우도법을 활용한 분포 적합과 보험 모델링"
date: "2025-02-11"
category: "model-fitting"
tags: ["최대우도법", "분포적합", "보험모델링"]
excerpt: "최대우도법의 이론적 배경과 보험 모델링에서의 활용법을 살펴보고, 실무 적용 사례를 제공합니다."
---

최대우도법(Maximum Likelihood Estimation, MLE)은 분포 적합에서 가장 널리 사용되는 방법 중 하나입니다. 이번 포스트에서는 최대우도법의 이론적 배경과 보험 모델링에서의 실무적 활용법을 자세히 살펴보겠습니다.

## 최대우도법의 정의와 원리

최대우도법은 주어진 데이터를 관측할 확률이 가장 높은 모수를 찾는 방법입니다:

### 1. 우도함수 (Likelihood Function)

```
L(θ) = ∏ᵢ₌₁ⁿ f(xᵢ|θ)
```

여기서:
- **θ**: 모수 벡터
- **f(xᵢ|θ)**: 확률밀도함수
- **xᵢ**: 관측값
- **n**: 샘플 크기

### 2. 로그우도함수 (Log-Likelihood Function)

```
ℓ(θ) = log L(θ) = ∑ᵢ₌₁ⁿ log f(xᵢ|θ)
```

### 3. 최대우도 추정량

```
θ̂ = argmax_θ ℓ(θ)
```

## 보험업계에서의 최대우도법 활용

### 1. 주요 활용 영역

- **손해액 모델링**: 보험 손해액 분포의 모수 추정
- **사고 빈도**: 사고 발생 빈도의 모수 추정
- **생존시간**: 생명보험에서의 생존시간 모델링
- **재해 분석**: 자연재해 손해액 분포 분석

### 2. 파이썬을 활용한 최대우도법 구현

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats
from scipy.optimize import minimize
from scipy.stats import norm, gamma, expon, weibull_min, lognorm
import warnings
warnings.filterwarnings('ignore')

# 보험 손해액 데이터 생성 (예시)
np.random.seed(42)
n_samples = 1000

# 감마분포에서 생성된 데이터
shape = 2.0
scale = 1000.0
damage_data = np.random.gamma(shape, scale, n_samples)

print("보험 손해액 데이터 기본 통계:")
print(f"평균: {np.mean(damage_data):.2f}")
print(f"분산: {np.var(damage_data):.2f}")
print(f"왜도: {stats.skew(damage_data):.2f}")
print(f"첨도: {stats.kurtosis(damage_data):.2f}")
```

### 3. 최대우도법 구현

```python
def log_likelihood_gamma(params, data):
    """감마분포의 로그우도함수"""
    shape, scale = params
    if shape <= 0 or scale <= 0:
        return -np.inf
    return np.sum(stats.gamma.logpdf(data, shape, scale=scale))

def log_likelihood_normal(params, data):
    """정규분포의 로그우도함수"""
    mu, sigma = params
    if sigma <= 0:
        return -np.inf
    return np.sum(stats.norm.logpdf(data, mu, sigma))

def log_likelihood_exponential(params, data):
    """지수분포의 로그우도함수"""
    scale = params[0]
    if scale <= 0:
        return -np.inf
    return np.sum(stats.expon.logpdf(data, scale=scale))

def mle_estimation(data, distribution='gamma'):
    """최대우도법을 통한 모수 추정"""
    
    if distribution == 'gamma':
        # 초기값 설정
        initial_params = [2.0, 1000.0]
        bounds = [(0.1, 10.0), (100.0, 5000.0)]
        log_likelihood_func = log_likelihood_gamma
        
    elif distribution == 'normal':
        # 초기값 설정
        initial_params = [np.mean(data), np.std(data)]
        bounds = [(None, None), (0.1, None)]
        log_likelihood_func = log_likelihood_normal
        
    elif distribution == 'exponential':
        # 초기값 설정
        initial_params = [np.mean(data)]
        bounds = [(0.1, None)]
        log_likelihood_func = log_likelihood_exponential
    
    # 최적화
    result = minimize(
        lambda params: -log_likelihood_func(params, data),
        initial_params,
        method='L-BFGS-B',
        bounds=bounds
    )
    
    if result.success:
        return result.x, -result.fun
    else:
        print(f"최적화 실패: {result.message}")
        return None, None

# 최대우도법 실행
gamma_params, gamma_loglik = mle_estimation(damage_data, 'gamma')
normal_params, normal_loglik = mle_estimation(damage_data, 'normal')
exp_params, exp_loglik = mle_estimation(damage_data, 'exponential')

print(f"\n감마분포 MLE: shape={gamma_params[0]:.2f}, scale={gamma_params[1]:.2f}")
print(f"정규분포 MLE: μ={normal_params[0]:.2f}, σ={normal_params[1]:.2f}")
print(f"지수분포 MLE: scale={exp_params[0]:.2f}")
```

### 4. 모델 비교

```python
def model_comparison(data, models):
    """모델 비교"""
    
    results = {}
    
    for name, (params, loglik) in models.items():
        if params is not None:
            # AIC 계산
            n_params = len(params)
            aic = 2 * n_params - 2 * loglik
            
            # BIC 계산
            n_samples = len(data)
            bic = n_params * np.log(n_samples) - 2 * loglik
            
            results[name] = {
                'params': params,
                'log_likelihood': loglik,
                'aic': aic,
                'bic': bic
            }
            
            print(f"{name}:")
            print(f"  Log-Likelihood: {loglik:.2f}")
            print(f"  AIC: {aic:.2f}")
            print(f"  BIC: {bic:.2f}")
    
    return results

# 모델 비교 실행
models = {
    '감마분포': (gamma_params, gamma_loglik),
    '정규분포': (normal_params, normal_loglik),
    '지수분포': (exp_params, exp_loglik)
}

comparison_results = model_comparison(damage_data, models)
```

## 엑셀을 활용한 최대우도법

### 1. 기본 설정

```excel
A1: 손해액
B1: 로그우도
C1: 누적로그우도

A2: =RAND()*5000+1000
B2: =LN(GAMMA.DIST(A2,2,1000,TRUE))
C2: =SUM(B$2:B2)
```

### 2. 최대우도법 구현

```excel
# 감마분포 모수 추정
A5: 모양모수
B5: =2.0
A6: 척도모수
B6: =1000.0

# 로그우도 계산
A8: 로그우도
B8: =SUM(LN(GAMMA.DIST(A2:A1001,B5,B6,TRUE)))

# 최적화 (Solver 사용)
A10: 목표셀
B10: =B8
A11: 변경셀
B11: =B5:B6
A12: 제약조건
B12: B5>0, B6>0
```

### 3. 모델 비교

```excel
# AIC 계산
A15: 모델
B15: 파라미터수
C15: 로그우도
D15: AIC

A16: 감마분포
B16: 2
C16: =B8
D16: =2*B16-2*C16

A17: 정규분포
B17: 2
C17: =SUM(LN(NORM.DIST(A2:A1001,AVERAGE(A2:A1001),STDEV(A2:A1001),TRUE)))
D17: =2*B17-2*C17
```

## 고급 분석 기법

### 1. 제약조건이 있는 최대우도법

```python
def constrained_mle(data, constraints):
    """제약조건이 있는 최대우도법"""
    
    def objective(params):
        shape, scale = params
        if shape <= 0 or scale <= 0:
            return np.inf
        
        # 제약조건 확인
        if constraints['min_shape'] <= shape <= constraints['max_shape'] and \
           constraints['min_scale'] <= scale <= constraints['max_scale']:
            return -np.sum(stats.gamma.logpdf(data, shape, scale=scale))
        else:
            return np.inf
    
    # 초기값 설정
    initial_params = [2.0, 1000.0]
    
    # 최적화
    result = minimize(
        objective,
        initial_params,
        method='L-BFGS-B',
        bounds=[(constraints['min_shape'], constraints['max_shape']),
                (constraints['min_scale'], constraints['max_scale'])]
    )
    
    return result.x, -result.fun

# 제약조건 설정
constraints = {
    'min_shape': 0.5,
    'max_shape': 5.0,
    'min_scale': 500.0,
    'max_scale': 2000.0
}

# 제약조건이 있는 MLE 실행
constrained_params, constrained_loglik = constrained_mle(damage_data, constraints)
print(f"제약조건이 있는 MLE: shape={constrained_params[0]:.2f}, scale={constrained_params[1]:.2f}")
```

### 2. 베이지안 최대우도법

```python
def bayesian_mle(data, prior_params):
    """베이지안 최대우도법"""
    
    def posterior_log_likelihood(params):
        shape, scale = params
        if shape <= 0 or scale <= 0:
            return -np.inf
        
        # 사전분포 (감마분포)
        prior_shape = prior_params['shape']
        prior_scale = prior_params['scale']
        
        # 사전분포 로그우도
        prior_loglik = stats.gamma.logpdf(shape, prior_shape, scale=prior_scale)
        prior_loglik += stats.gamma.logpdf(scale, prior_shape, scale=prior_scale)
        
        # 가능도 함수
        likelihood_loglik = np.sum(stats.gamma.logpdf(data, shape, scale=scale))
        
        return prior_loglik + likelihood_loglik
    
    # 초기값 설정
    initial_params = [2.0, 1000.0]
    
    # 최적화
    result = minimize(
        lambda params: -posterior_log_likelihood(params),
        initial_params,
        method='L-BFGS-B',
        bounds=[(0.1, 10.0), (100.0, 5000.0)]
    )
    
    return result.x, -result.fun

# 사전분포 파라미터 설정
prior_params = {
    'shape': 2.0,
    'scale': 1000.0
}

# 베이지안 MLE 실행
bayesian_params, bayesian_loglik = bayesian_mle(damage_data, prior_params)
print(f"베이지안 MLE: shape={bayesian_params[0]:.2f}, scale={bayesian_params[1]:.2f}")
```

## 실무 적용 사례

### 사례 1: 자동차보험 손해액 모델링

```python
def auto_insurance_damage_modeling():
    """자동차보험 손해액 모델링"""
    
    # 실제 자동차보험 데이터 (예시)
    np.random.seed(42)
    n_samples = 2000
    
    # 혼합분포 데이터
    normal_damage = np.random.normal(2000, 500, 1200)
    severe_damage = np.random.gamma(2, 2000, 800)
    damage_data = np.concatenate([normal_damage, severe_damage])
    
    # 분포별 MLE 추정
    distributions = ['gamma', 'normal', 'exponential']
    results = {}
    
    for dist in distributions:
        params, loglik = mle_estimation(damage_data, dist)
        if params is not None:
            results[dist] = (params, loglik)
    
    # 최적 모델 선택
    best_model = min(results.items(), key=lambda x: 2 * len(x[1][0]) - 2 * x[1][1])
    print(f"최적 모델: {best_model[0]} (AIC: {2 * len(best_model[1][0]) - 2 * best_model[1][1]:.2f})")
    
    return best_model

# 자동차보험 손해액 모델링 실행
best_model = auto_insurance_damage_modeling()
```

### 사례 2: 보험료 산출 시스템

```python
def premium_calculation_with_mle(model, customer_data):
    """MLE를 통한 보험료 산출 시스템"""
    
    dist_name, (params, loglik) = model
    
    # 예측 손해액 분포
    if dist_name == 'gamma':
        predicted_damage = stats.gamma.rvs(params[0], scale=params[1], size=1000)
    elif dist_name == 'normal':
        predicted_damage = stats.norm.rvs(params[0], params[1], size=1000)
    elif dist_name == 'exponential':
        predicted_damage = stats.expon.rvs(scale=params[0], size=1000)
    
    # 위험도 평가
    risk_percentile = np.percentile(predicted_damage, 95)
    expected_damage = np.mean(predicted_damage)
    
    # 보험료 계산
    base_premium = expected_damage * 0.1
    risk_loading = (risk_percentile - expected_damage) * 0.05
    total_premium = base_premium + risk_loading
    
    return {
        'expected_damage': expected_damage,
        'risk_percentile': risk_percentile,
        'base_premium': base_premium,
        'risk_loading': risk_loading,
        'total_premium': total_premium
    }

# 보험료 산출 시스템 실행
customer_data = {'age': 30, 'driving_experience': 5}
premium_result = premium_calculation_with_mle(best_model, customer_data)
for key, value in premium_result.items():
    print(f"{key}: {value:.2f}")
```

## 최대우도법의 한계와 대안

### 1. 최대우도법의 한계

- **분포 가정**: 특정 분포 형태 가정 필요
- **모수 추정**: 제한된 모수로 복잡한 분포 모델링 어려움
- **이상치 민감성**: 극단적 값에 대한 과도한 영향

### 2. 대안 방법들

- **모멘트법**: 분포의 모멘트를 이용한 모수 추정
- **최소제곱법**: 분포 함수와 데이터 간의 차이 최소화
- **베이지안 방법**: 불확실성 정량화
- **비모수 방법**: 분포 가정 없이 데이터 분석

## 결론

최대우도법은 보험업계에서 분포 적합의 핵심 기법입니다. 특히 모수 추정의 정확성과 해석 가능성이 높아 보험 모델링에 직접적으로 활용할 수 있습니다.

다음 포스트에서는 모멘트법을 활용한 분포 적합에 대해 살펴보겠습니다.

## 참고자료

- [Real Statistics - Distribution Fitting](https://real-statistics.com/distribution-fitting/)
- Klugman, S. A., Panjer, H. H., & Willmot, G. E. (2012). Loss Models: From Data to Decisions
- Kaas, R., Goovaerts, M., Dhaene, J., & Denuit, M. (2008). Modern Actuarial Risk Theory
